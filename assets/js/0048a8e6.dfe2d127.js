"use strict";(globalThis.webpackChunkdialai_website=globalThis.webpackChunkdialai_website||[]).push([[2561],{8661(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"concepts/arbitration","title":"Arbitration","description":"Arbitration is the process of evaluating consensus and determining when a proposal has sufficient support to execute.","source":"@site/docs/concepts/arbitration.md","sourceDirName":"concepts","slug":"/concepts/arbitration","permalink":"/dialai/docs/concepts/arbitration","draft":false,"unlisted":false,"editUrl":"https://github.com/eloquentanalytics/dialai/tree/main/website/docs/concepts/arbitration.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Decision Cycle","permalink":"/dialai/docs/concepts/decision-cycle"},"next":{"title":"Human Primacy","permalink":"/dialai/docs/concepts/human-primacy"}}');var r=i(4848),t=i(8453);const a={sidebar_position:5},l="Arbitration",o={},d=[{value:"Overview",id:"overview",level:2},{value:"The Default Arbiter: Weighted Ahead-by-K",id:"the-default-arbiter-weighted-ahead-by-k",level:2},{value:"Rules",id:"rules",level:3},{value:"Example",id:"example",level:3},{value:"Human Override",id:"human-override",level:3},{value:"The Risk Dial",id:"the-risk-dial",level:2},{value:"Concept",id:"concept",level:3},{value:"Below Threshold: Full Deliberation",id:"below-threshold-full-deliberation",level:3},{value:"Above Threshold: Express Lane",id:"above-threshold-express-lane",level:3},{value:"Trip Wire",id:"trip-wire",level:3},{value:"Vote Types",id:"vote-types",level:2},{value:"Handling NEITHER Votes",id:"handling-neither-votes",level:3},{value:"Arbiter Strategy Interface",id:"arbiter-strategy-interface",level:2},{value:"Example: Custom Arbiter",id:"example-custom-arbiter",level:3},{value:"Consensus Evaluation Command",id:"consensus-evaluation-command",level:2},{value:"Configuring Arbitration",id:"configuring-arbitration",level:2},{value:"Per-State Risk Dial",id:"per-state-risk-dial",level:3},{value:"Ahead-by-K Value",id:"ahead-by-k-value",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Start Conservative",id:"1-start-conservative",level:3},{value:"2. Monitor NEITHER Votes",id:"2-monitor-neither-votes",level:3},{value:"3. Calibrate Risk Per State",id:"3-calibrate-risk-per-state",level:3},{value:"4. Log Arbiter Reasoning",id:"4-log-arbiter-reasoning",level:3},{value:"Related Concepts",id:"related-concepts",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"arbitration",children:"Arbitration"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Arbitration"})," is the process of evaluating consensus and determining when a proposal has sufficient support to execute."]}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["After specialists submit proposals and cast votes, an ",(0,r.jsx)(n.strong,{children:"Arbiter"})," analyzes the results:"]}),"\n",(0,r.jsx)(n.mermaid,{value:"graph LR\n    V[Votes] --\x3e A[Arbiter]\n    P[Proposals] --\x3e A\n    R[Risk Dial] --\x3e A\n    A --\x3e |Consensus| E[Execute]\n    A --\x3e |No Consensus| M[More Voting]"}),"\n",(0,r.jsx)(n.p,{children:"Arbiters are pluggable strategies\u2014you can implement custom consensus logic while DIAL handles the coordination."}),"\n",(0,r.jsx)(n.h2,{id:"the-default-arbiter-weighted-ahead-by-k",children:"The Default Arbiter: Weighted Ahead-by-K"}),"\n",(0,r.jsxs)(n.p,{children:["DIAL ships with a default arbitration strategy that implements ",(0,r.jsx)(n.strong,{children:"weighted voting with human override"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"rules",children:"Rules"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Human votes win immediately"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"If any human has voted, their choice wins"}),"\n",(0,r.jsx)(n.li,{children:"No further calculation needed"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"AI votes are weighted"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Each AI specialist has a weight (0.0 - 1.0+)"}),"\n",(0,r.jsx)(n.li,{children:"Weights are earned through alignment with human choices"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Ahead-by-K threshold"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The leading proposal must be ahead by ",(0,r.jsx)(n.code,{children:"k"})," weighted votes"]}),"\n",(0,r.jsxs)(n.li,{children:["Default ",(0,r.jsx)(n.code,{children:"k = 1.0"})," (must have a full point lead)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Proposal A: "Approve"\n  - AI Specialist 1 votes A (weight 0.6)\n  - AI Specialist 2 votes A (weight 0.4)\n  Total for A: 1.0\n\nProposal B: "Request Changes"  \n  - AI Specialist 3 votes B (weight 0.3)\n  Total for B: 0.3\n\nAhead by: 1.0 - 0.3 = 0.7\n\nIf k = 0.5: Consensus reached \u2713 (0.7 > 0.5)\nIf k = 1.0: No consensus \u2717 (0.7 < 1.0)\n'})}),"\n",(0,r.jsx)(n.h3,{id:"human-override",children:"Human Override"}),"\n",(0,r.jsx)(n.p,{children:"When a human votes, the calculation changes:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Proposal A: "Approve"\n  - AI Specialist 1 votes A (weight 0.8)\n  - AI Specialist 2 votes A (weight 0.7)\n\nProposal B: "Request Changes"\n  - Human votes B (weight 1.0)\n\nResult: B wins immediately \u2713\n\nHuman primacy: AI votes don\'t matter when humans participate.\n'})}),"\n",(0,r.jsx)(n.h2,{id:"the-risk-dial",children:"The Risk Dial"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:"risk dial"})," is a per-state confidence threshold that controls how much deliberation is required."]}),"\n",(0,r.jsx)(n.h3,{id:"concept",children:"Concept"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Risk Dial: 0.0 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 1.0\n           \u2502                           \u2502\n           \u2502  Full Deliberation        \u2502  Express Lane\n           \u2502  (Propose \u2192 Vote \u2192        \u2502  (Champion only,\n           \u2502   Arbitrate \u2192 Execute)    \u2502   quick check)\n           \u2502                           \u2502\n"})}),"\n",(0,r.jsx)(n.h3,{id:"below-threshold-full-deliberation",children:"Below Threshold: Full Deliberation"}),"\n",(0,r.jsx)(n.p,{children:"When confidence is low:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"All registered proposers are solicited"}),"\n",(0,r.jsx)(n.li,{children:"Pairwise voting occurs"}),"\n",(0,r.jsx)(n.li,{children:"Full arbitration runs"}),"\n",(0,r.jsx)(n.li,{children:"Slower, more expensive, safer"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"above-threshold-express-lane",children:"Above Threshold: Express Lane"}),"\n",(0,r.jsx)(n.p,{children:"When confidence is high:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'A single "champion" specialist proposes'}),"\n",(0,r.jsx)(n.li,{children:"Quick guardrail checks (not full voting)"}),"\n",(0,r.jsx)(n.li,{children:"Immediate execution if checks pass"}),"\n",(0,r.jsx)(n.li,{children:"Faster, cheaper, requires proven track record"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"trip-wire",children:"Trip Wire"}),"\n",(0,r.jsx)(n.p,{children:'If the champion makes a suboptimal choice (detected by configured criteria), the risk dial "trips":'}),"\n",(0,r.jsx)(n.mermaid,{value:"graph TD\n    E[Express Lane] --\x3e |Champion proposes| C[Check Guardrails]\n    C --\x3e |Pass| X[Execute]\n    C --\x3e |Fail| T[Trip Wire!]\n    T --\x3e F[Full Deliberation]\n    F --\x3e |Rebuild trust| E"}),"\n",(0,r.jsx)(n.p,{children:"The system drops back to full deliberation until confidence is rebuilt."}),"\n",(0,r.jsx)(n.h2,{id:"vote-types",children:"Vote Types"}),"\n",(0,r.jsx)(n.p,{children:"Specialists can vote in four ways:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Vote"}),(0,r.jsx)(n.th,{children:"Meaning"}),(0,r.jsx)(n.th,{children:"Impact"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"A"})}),(0,r.jsx)(n.td,{children:"Prefer proposal A"}),(0,r.jsx)(n.td,{children:"+weight to A"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"B"})}),(0,r.jsx)(n.td,{children:"Prefer proposal B"}),(0,r.jsx)(n.td,{children:"+weight to B"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"BOTH"})}),(0,r.jsx)(n.td,{children:"Both acceptable"}),(0,r.jsx)(n.td,{children:"Tie signal"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"NEITHER"})}),(0,r.jsx)(n.td,{children:"Both unacceptable"}),(0,r.jsx)(n.td,{children:"Block signal"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"handling-neither-votes",children:"Handling NEITHER Votes"}),"\n",(0,r.jsx)(n.p,{children:"When specialists vote NEITHER, it signals that available options are inadequate:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"May trigger additional proposal solicitation"}),"\n",(0,r.jsx)(n.li,{children:"May escalate to human intervention"}),"\n",(0,r.jsx)(n.li,{children:"Prevents low-quality consensus"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"arbiter-strategy-interface",children:"Arbiter Strategy Interface"}),"\n",(0,r.jsx)(n.p,{children:"Custom arbiters implement this interface:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface ArbiterDecisionInput {\n  proposals: Proposal[];      // All proposals for this round\n  votes: Vote[];              // All votes cast\n  riskDial: number;           // State-level risk configuration\n}\n\ninterface ArbiterDecisionOutput {\n  consensusReached: boolean;\n  winningProposalId?: string;\n  reasoning: string;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example-custom-arbiter",children:"Example: Custom Arbiter"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// strategies/my-task/arbiter.ts\nexport async function arbitrate(\n  input: ArbiterDecisionInput\n): Promise<ArbiterDecisionOutput> {\n  const { proposals, votes, riskDial } = input;\n  \n  // Calculate weighted scores\n  const scores = calculateWeightedScores(proposals, votes);\n  \n  // Check for human votes (human primacy)\n  const humanVote = votes.find(v => isHumanSpecialist(v.specialistId));\n  if (humanVote) {\n    return {\n      consensusReached: true,\n      winningProposalId: humanVote.voteFor === 'A' \n        ? humanVote.proposalIdA \n        : humanVote.proposalIdB,\n      reasoning: \"Human vote received - immediate consensus\"\n    };\n  }\n  \n  // Check ahead-by-k\n  const sorted = Object.entries(scores)\n    .sort(([, a], [, b]) => b - a);\n  \n  const leader = sorted[0];\n  const runnerUp = sorted[1] || [null, 0];\n  const margin = leader[1] - runnerUp[1];\n  \n  const threshold = riskDial > 0.7 ? 0.5 : 1.0; // Lower threshold at high confidence\n  \n  if (margin >= threshold) {\n    return {\n      consensusReached: true,\n      winningProposalId: leader[0],\n      reasoning: `Consensus reached with margin ${margin.toFixed(2)} >= ${threshold}`\n    };\n  }\n  \n  return {\n    consensusReached: false,\n    reasoning: `No consensus - margin ${margin.toFixed(2)} < ${threshold}`\n  };\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"consensus-evaluation-command",children:"Consensus Evaluation Command"}),"\n",(0,r.jsx)(n.p,{children:"Trigger arbitration via the API:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'const result = await evaluateConsensus({\n  sessionId: "session-123",\n  fromTransitionExecutionId: "exec-456"  // Optional: filter to this round\n});\n\n// Result:\n{\n  consensusReached: true,\n  winningProposalId: "proposal-789",\n  reasoning: "Human vote received - immediate consensus"\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"configuring-arbitration",children:"Configuring Arbitration"}),"\n",(0,r.jsx)(n.h3,{id:"per-state-risk-dial",children:"Per-State Risk Dial"}),"\n",(0,r.jsx)(n.p,{children:"Set the risk dial in your state machine definition:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'states: {\n  reviewing: {\n    meta: {\n      prompt: "Review and approve or reject",\n      riskDial: 0.3  // Low confidence - full deliberation\n    }\n  },\n  auto_categorize: {\n    meta: {\n      prompt: "Categorize this item",\n      riskDial: 0.9  // High confidence - express lane eligible\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"ahead-by-k-value",children:"Ahead-by-K Value"}),"\n",(0,r.jsx)(n.p,{children:"Configure the default threshold:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const arbiterConfig = {\n  aheadByK: 1.0,           // Default\n  expressLaneK: 0.3,       // Lower threshold in express lane\n  humanOverride: true      // Human votes always win\n};\n"})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"1-start-conservative",children:"1. Start Conservative"}),"\n",(0,r.jsx)(n.p,{children:"Begin with low risk dial values and strict ahead-by-k thresholds:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"riskDial: 0.1    // Almost always full deliberation\naheadByK: 1.5    // Require strong consensus\n"})}),"\n",(0,r.jsx)(n.p,{children:"As you gather alignment data, gradually relax."}),"\n",(0,r.jsx)(n.h3,{id:"2-monitor-neither-votes",children:"2. Monitor NEITHER Votes"}),"\n",(0,r.jsx)(n.p,{children:"High NEITHER rates indicate:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Poor proposal quality"}),"\n",(0,r.jsx)(n.li,{children:"Unclear decision prompts"}),"\n",(0,r.jsx)(n.li,{children:"Specialists that don't understand the task"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Track and investigate:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT state_name, COUNT(*) as neither_count\nFROM votes\nWHERE vote_for = 'NEITHER'\nGROUP BY state_name\nORDER BY neither_count DESC;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-calibrate-risk-per-state",children:"3. Calibrate Risk Per State"}),"\n",(0,r.jsx)(n.p,{children:"Not all states need the same deliberation:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"State Type"}),(0,r.jsx)(n.th,{children:"Risk Dial"}),(0,r.jsx)(n.th,{children:"Rationale"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"High-stakes decisions"}),(0,r.jsx)(n.td,{children:"0.0 - 0.3"}),(0,r.jsx)(n.td,{children:"Always involve humans"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Routine categorization"}),(0,r.jsx)(n.td,{children:"0.5 - 0.8"}),(0,r.jsx)(n.td,{children:"Automation-friendly"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Data validation"}),(0,r.jsx)(n.td,{children:"0.8 - 0.95"}),(0,r.jsx)(n.td,{children:"Highly automatable"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"4-log-arbiter-reasoning",children:"4. Log Arbiter Reasoning"}),"\n",(0,r.jsx)(n.p,{children:"Always include clear reasoning in arbiter output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'// Good\nreasoning: "Consensus reached: Proposal A leads by 1.2 weighted votes (threshold: 1.0). 3 AI voters, 0 human voters."\n\n// Bad  \nreasoning: "Consensus"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/dialai/docs/concepts/decision-cycle",children:"Decision Cycle"})," \u2014 Where arbitration fits"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/dialai/docs/concepts/specialists",children:"Specialists"})," \u2014 Voting weights"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/dialai/docs/concepts/human-primacy",children:"Human Primacy"})," \u2014 Why humans override"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);